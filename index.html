<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arvian Motor - Kode Kerusakan FI</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        :root {
            --primary-color: #1976D2;
            --accent-color: #FF9800;
            --bg-color: #F4F7F6;
            --text-dark: #333333;
            --card-bg: #FFFFFF;
            --nav-height: 70px;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-dark);
            padding-bottom: var(--nav-height); /* Space for bottom nav */
            overflow-x: hidden;
        }

        /* --- Header --- */
        .app-header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        /* --- Animations --- */
        .fade-in {
            animation: fadeIn 0.4s ease-in-out;
        }
        
        .slide-up {
            animation: slideUp 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* --- Cards --- */
        .custom-card {
            border: none;
            border-radius: 15px;
            background: var(--card-bg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            margin-bottom: 15px;
            overflow: hidden;
        }

        .custom-card:active {
            transform: scale(0.98);
        }

        .code-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 8px 12px;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1.1rem;
            min-width: 50px;
            text-align: center;
        }

        .code-badge.yamaha {
            background-color: #D32F2F; /* Merah untuk Yamaha distinct */
        }

        /* --- Search Bar --- */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        .search-input {
            border-radius: 30px;
            padding: 12px 20px 12px 50px;
            border: none;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            width: 100%;
        }
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaa;
        }

        /* --- Bottom Nav --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            height: var(--nav-height);
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #999;
            text-decoration: none;
            font-size: 0.75rem;
            transition: color 0.3s;
        }

        .nav-item i {
            font-size: 24px;
            margin-bottom: 2px;
            transition: transform 0.2s;
        }

        .nav-item.active {
            color: var(--primary-color);
            font-weight: 600;
        }

        .nav-item.active i {
            transform: translateY(-2px);
        }

        /* --- Modal Detail --- */
        .modal-header-custom {
            background-color: var(--primary-color);
            color: white;
        }
        
        .section-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #666;
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* --- Components --- */
        .btn-promo {
            background: linear-gradient(45deg, var(--primary-color), #2196F3);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 20px;
            text-align: left;
            width: 100%;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .btn-promo h3 { font-size: 1.2rem; font-weight: 700; margin-bottom: 5px; }
        .btn-promo p { margin: 0; font-size: 0.9rem; opacity: 0.9; }

        .btn-fav {
            color: #ccc;
            transition: color 0.3s;
        }
        .btn-fav.active {
            color: var(--accent-color);
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1050;
        }

        /* Shimmer Loading Effect */
        .shimmer {
            background: #f6f7f8;
            background-image: linear-gradient(to right, #f6f7f8 0%, #edeef1 20%, #f6f7f8 40%, #f6f7f8 100%);
            background-repeat: no-repeat;
            background-size: 800px 104px; 
            animation-duration: 1s;
            animation-fill-mode: forwards; 
            animation-iteration-count: infinite;
            animation-name: placeholderShimmer;
            animation-timing-function: linear;
        }

        @keyframes placeholderShimmer {
            0% { background-position: -468px 0; }
            100% { background-position: 468px 0; }
        }

        /* Contact Section */
        .contact-card {
            text-align: center;
            padding: 20px;
        }
        .contact-icon {
            width: 50px;
            height: 50px;
            background: #E3F2FD;
            color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 24px;
        }

    </style>
</head>
<body>

    <div id="app-content">
        </div>

    <nav class="bottom-nav">
        <a href="#" class="nav-item active" onclick="router('home')">
            <i class="material-icons">home</i>
            <span>Home</span>
        </a>
        <a href="#" class="nav-item" onclick="router('honda')">
            <i class="material-icons">two_wheeler</i>
            <span>Honda</span>
        </a>
        <a href="#" class="nav-item" onclick="router('yamaha')">
            <i class="material-icons">sports_motorsports</i>
            <span>Yamaha</span>
        </a>
        <a href="#" class="nav-item" onclick="router('tips')">
            <i class="material-icons">lightbulb</i>
            <span>Tips</span>
        </a>
        <a href="#" class="nav-item" onclick="router('favorites')">
            <i class="material-icons">favorite</i>
            <span>Simpan</span>
        </a>
    </nav>

    <div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 20px; border: none;">
                <div class="modal-header modal-header-custom">
                    <h5 class="modal-title fw-bold" id="modalTitle">Detail Kerusakan</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="modalBody">
                    </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-outline-secondary rounded-pill px-4" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-warning rounded-pill px-4 text-white fw-bold" id="btnModalFav">
                        <i class="material-icons" style="font-size:18px; vertical-align:middle;">star</i> Simpan
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast-container">
        <div id="liveToast" class="toast align-items-center text-white bg-dark border-0 rounded-pill px-3" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body" id="toastMessage">
                    Data berhasil disimpan!
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- DATASET ---
        const hondaData = [
            { code: 1, sensor: "MAP Sensor", cause: "Tegangan tidak normal pada Manifold Absolute Pressure", solution: "Periksa soket MAP, cek kebocoran selang, atau ganti sensor MAP." },
            { code: 2, sensor: "TPS Sensor", cause: "Posisi throttle tidak terbaca dengan benar (kabel putus/short)", solution: "Cek konektor TPS, kalibrasi ulang, atau ganti TPS." },
            { code: 7, sensor: "EOT/ECT Sensor", cause: "Tegangan sensor suhu mesin/oli tidak normal", solution: "Cek kabel sensor EOT/ECT, bersihkan soket, ganti sensor." },
            { code: 8, sensor: "TP Sensor", cause: "Rangkaian Throttle Position bermasalah", solution: "Periksa sambungan kabel, cek unit sensor." },
            { code: 9, sensor: "IAT Sensor", cause: "Tegangan Intake Air Temperature bermasalah", solution: "Periksa soket IAT di filter udara, cek kabel putus." },
            { code: 11, sensor: "VS Sensor", cause: "Speedometer/Vehicle Speed tidak terbaca", solution: "Cek kabel speed sensor di gearbox atau roda belakang." },
            { code: 12, sensor: "Injector", cause: "Rangkaian injektor putus atau short", solution: "Cek soket injektor, cek tegangan input 12V, bersihkan/ganti injektor." },
            { code: 21, sensor: "O2 Sensor", cause: "Oksigen sensor bermasalah (Gas buang error)", solution: "Cek kabel O2 sensor di knalpot, bersihkan atau ganti." },
            { code: 29, sensor: "IACV", cause: "Idle Air Control Valve error (Langsam tidak stabil)", solution: "Reset ECU, bersihkan IACV, atau ganti unit IACV." },
            { code: 33, sensor: "ECM / ECU", cause: "Masalah pada memori Engine Control Module", solution: "Coba reset ECU, cek grounding, jika tetap muncul ganti ECU." },
            { code: 52, sensor: "CKP Sensor", cause: "Posisi Crankshaft tidak terbaca (Motor mogok)", solution: "Cek kabel spull/CKP, cek soket kotor." },
            { code: 54, sensor: "Bank Angle", cause: "Sensor kemiringan error (Motor dianggap jatuh)", solution: "Tegakkan motor, matikan kontak, nyalakan lagi. Cek pemasangan sensor." }
        ];

        const yamahaData = [
            { code: 12, sensor: "CKP Sensor", cause: "Sinyal Crankshaft Position tidak diterima", solution: "Cek kabel spull, soket CKP gosong/kendor, atau ganti spull." },
            { code: 13, sensor: "Intake Air Pressure", cause: "Sirkuit sensor tekanan udara error", solution: "Periksa selang vakum, cek soket sensor." },
            { code: 14, sensor: "Intake Air Pressure", cause: "Selang sensor terlepas atau tersumbat", solution: "Pasang kembali selang sensor dengan benar." },
            { code: 15, sensor: "TPS", cause: "Throttle Position Sensor macet/terbuka", solution: "Cek bukaan gas, kalibrasi TPS, ganti jika nilai resistansi ngaco." },
            { code: 16, sensor: "TPS", cause: "TPS macet tertutup", solution: "Periksa mekanisme throttle body, bersihkan." },
            { code: 19, sensor: "Side Stand Switch", cause: "Saklar standar samping putus/korslet", solution: "Cek kabel switch standar samping (hijau/hitam)." },
            { code: 21, sensor: "Coolant Temp", cause: "Sensor suhu cairan pendingin error", solution: "Cek sensor suhu di blok mesin/radiator." },
            { code: 24, sensor: "O2 Sensor", cause: "O2 Sensor tidak normal", solution: "Ganti O2 sensor jika pemanasan mesin sudah cukup." },
            { code: 37, sensor: "ISC Valve", cause: "Idle Speed Control macet (Langsam naik turun)", solution: "Bersihkan ISC, reset manual, atau ganti ISC." },
            { code: 39, sensor: "Fuel Injector", cause: "Sirkuit injektor terbuka atau short", solution: "Cek kabel ke injektor, ukur resistansi injektor." },
            { code: 42, sensor: "Speed Sensor", cause: "Sinyal kecepatan tidak normal", solution: "Cek kabel sensor speedo di roda depan/mesin." },
            { code: 46, sensor: "Power Supply", cause: "Tegangan aki/pengisian tidak stabil", solution: "Cek Aki, Kiprok, dan Spull." },
            { code: 50, sensor: "ECU Memory", cause: "Kerusakan internal ECU", solution: "Ganti ECU." }
        ];

        // --- STATE & UTILS ---
        let favorites = JSON.parse(localStorage.getItem('arvianFavs')) || [];
        
        function saveToLocal() {
            localStorage.setItem('arvianFavs', JSON.stringify(favorites));
        }

        function showToast(msg) {
            const toastEl = document.getElementById('liveToast');
            document.getElementById('toastMessage').innerText = msg;
            const toast = new bootstrap.Toast(toastEl, { delay: 2000 });
            toast.show();
        }

        // --- ROUTING ---
        function router(page) {
            const content = document.getElementById('app-content');
            
            // Update Active Nav
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            // Find nav item containing the onclick matching the page
            const navLink = document.querySelector(`.nav-item[onclick="router('${page}')"]`);
            if(navLink) navLink.classList.add('active');

            window.scrollTo(0,0);

            switch(page) {
                case 'home': renderHome(); break;
                case 'honda': renderList('Honda PGM-FI', hondaData, 'honda'); break;
                case 'yamaha': renderList('Yamaha FI', yamahaData, 'yamaha'); break;
                case 'tips': renderTips(); break;
                case 'favorites': renderFavorites(); break;
                default: renderHome();
            }
        }

        // --- RENDER FUNCTIONS ---

        function renderHome() {
            const html = `
                <div class="app-header">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <small class="d-block opacity-75">Selamat Datang,</small>
                            <h4 class="fw-bold m-0">Arvian Motor</h4>
                        </div>
                        <img src="https://ui-avatars.com/api/?name=Arvian+Motor&background=fff&color=1976D2&bold=true" class="rounded-circle" width="40">
                    </div>
                </div>

                <div class="container mt-4 fade-in">
                    <div class="btn-promo shadow-sm ripple" onclick="router('tips')">
                        <h3>Tips Perawatan</h3>
                        <p>Cara merawat motor injeksi agar awet.</p>
                        <i class="material-icons position-absolute" style="right: -10px; bottom: -10px; font-size: 80px; opacity: 0.2;">build</i>
                    </div>

                    <h6 class="fw-bold mb-3 text-secondary">Akses Cepat</h6>
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="custom-card p-3 text-center h-100" onclick="router('honda')">
                                <div class="bg-light rounded-circle d-inline-flex p-3 mb-2 text-primary">
                                    <i class="material-icons">two_wheeler</i>
                                </div>
                                <h6 class="fw-bold">Honda FI</h6>
                                <small class="text-muted">PGM-FI Codes</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="custom-card p-3 text-center h-100" onclick="router('yamaha')">
                                <div class="bg-light rounded-circle d-inline-flex p-3 mb-2 text-danger">
                                    <i class="material-icons">sports_motorsports</i>
                                </div>
                                <h6 class="fw-bold">Yamaha FI</h6>
                                <small class="text-muted">Mio, NMAX, dll</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="custom-card p-3 text-center h-100" onclick="router('tips')">
                                <div class="bg-light rounded-circle d-inline-flex p-3 mb-2 text-warning">
                                    <i class="material-icons">visibility</i>
                                </div>
                                <h6 class="fw-bold">Baca Kode</h6>
                                <small class="text-muted">Hitung Kedipan</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="custom-card p-3 text-center h-100" onclick="router('favorites')">
                                <div class="bg-light rounded-circle d-inline-flex p-3 mb-2 text-success">
                                    <i class="material-icons">bookmark</i>
                                </div>
                                <h6 class="fw-bold">Disimpan</h6>
                                <small class="text-muted">Favorit Saya</small>
                            </div>
                        </div>
                    </div>

                    <div class="card border-0 shadow-sm mt-4 mb-4 rounded-4">
                        <div class="card-body p-4">
                            <h5 class="fw-bold mb-3">Hubungi Arvian Motor</h5>
                            <div class="d-flex align-items-center mb-2">
                                <i class="material-icons text-primary me-2">location_on</i>
                                <span>Jl. Bengkel No. 12, Kota Otomotif</span>
                            </div>
                            <div class="d-flex align-items-center">
                                <i class="material-icons text-success me-2">whatsapp</i>
                                <span>0812-3456-7890</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('app-content').innerHTML = html;
        }

        function renderList(title, data, type) {
            const listHtml = data.map((item, index) => {
                const isFav = favorites.some(f => f.code === item.code && f.type === type);
                return `
                <div class="custom-card p-3 d-flex align-items-center slide-up" 
                     style="animation-delay: ${index * 0.05}s"
                     onclick="openDetail('${type}', ${item.code})">
                    <div class="code-badge ${type === 'yamaha' ? 'yamaha' : ''} me-3 shadow-sm">
                        ${item.code}
                    </div>
                    <div class="flex-grow-1">
                        <h6 class="fw-bold m-0 text-dark">${item.sensor}</h6>
                        <small class="text-muted text-truncate d-block" style="max-width: 200px;">
                            ${item.cause}
                        </small>
                    </div>
                    <i class="material-icons text-muted">chevron_right</i>
                </div>
                `;
            }).join('');

            const html = `
                <div class="app-header">
                    <div class="d-flex align-items-center">
                         <i class="material-icons me-2" onclick="router('home')" style="cursor:pointer">arrow_back</i>
                        <h5 class="fw-bold m-0 flex-grow-1">${title}</h5>
                    </div>
                </div>
                <div class="container mt-3">
                    <div class="search-container">
                        <i class="material-icons search-icon">search</i>
                        <input type="text" id="searchInput" class="search-input" placeholder="Cari kode atau nama sensor..." onkeyup="filterList('${type}')">
                    </div>
                    <div id="listContainer" class="pb-3">
                        ${listHtml}
                    </div>
                </div>
            `;
            document.getElementById('app-content').innerHTML = html;
        }

        function renderTips() {
            const html = `
                <div class="app-header">
                    <h5 class="fw-bold m-0">Tips & Panduan</h5>
                </div>
                <div class="container mt-3 fade-in">
                    
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-body">
                            <h6 class="fw-bold text-primary mb-2">Cara Membaca Lampu MIL</h6>
                            <p class="small text-muted mb-2">Lampu check engine berkedip untuk memberitahu kode kerusakan.</p>
                            <ul class="small mb-0 ps-3">
                                <li><strong>Kedipan Panjang (1.3 detik):</strong> Bernilai 10.</li>
                                <li><strong>Kedipan Pendek (0.3 detik):</strong> Bernilai 1.</li>
                                <li><em>Contoh:</em> 1 Panjang + 2 Pendek = Kode 12.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="accordion shadow-sm rounded-3 overflow-hidden" id="tipsAccordion">
                        <div class="accordion-item border-0">
                            <h2 class="accordion-header">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#tip1">
                                    <i class="material-icons me-2 text-warning">build</i> Reset ECU Honda
                                </button>
                            </h2>
                            <div id="tip1" class="accordion-collapse collapse show" data-bs-parent="#tipsAccordion">
                                <div class="accordion-body small">
                                    Gunakan jumper DLC (Data Link Connector). Hubungkan kabel hijau dan coklat. Putar kunci ON, cabut jumper saat lampu MIL nyala, pasang lagi dalam 5 detik.
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item border-0">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#tip2">
                                    <i class="material-icons me-2 text-info">history</i> Reset ISC Yamaha
                                </button>
                            </h2>
                            <div id="tip2" class="accordion-collapse collapse" data-bs-parent="#tipsAccordion">
                                <div class="accordion-body small">
                                    Putar kunci kontak ON, tunggu 3 detik, matikan (OFF). Ulangi proses ini sebanyak 3 kali agar posisi ISC terkalibrasi ulang.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('app-content').innerHTML = html;
        }

        function renderFavorites() {
            if (favorites.length === 0) {
                document.getElementById('app-content').innerHTML = `
                    <div class="app-header">
                        <h5 class="fw-bold m-0">Disimpan</h5>
                    </div>
                    <div class="container mt-5 text-center fade-in">
                        <i class="material-icons text-muted" style="font-size: 64px; opacity: 0.3;">bookmark_border</i>
                        <p class="mt-3 text-muted">Belum ada kode yang disimpan.</p>
                        <button class="btn btn-primary rounded-pill btn-sm mt-2" onclick="router('honda')">Cari Kode</button>
                    </div>
                `;
                return;
            }

            const listHtml = favorites.map((item, index) => {
                const db = item.type === 'honda' ? hondaData : yamahaData;
                const details = db.find(d => d.code === item.code);
                if (!details) return '';

                return `
                <div class="custom-card p-3 d-flex align-items-center slide-up" 
                     style="animation-delay: ${index * 0.05}s"
                     onclick="openDetail('${item.type}', ${item.code})">
                     <div class="code-badge ${item.type === 'yamaha' ? 'yamaha' : ''} me-3 shadow-sm">
                        ${details.code}
                    </div>
                    <div class="flex-grow-1">
                        <div class="d-flex justify-content-between">
                            <h6 class="fw-bold m-0">${details.sensor}</h6>
                            <span class="badge bg-secondary rounded-pill" style="font-size: 0.6rem;">${item.type.toUpperCase()}</span>
                        </div>
                        <small class="text-muted text-truncate d-block" style="max-width: 200px;">
                            ${details.cause}
                        </small>
                    </div>
                </div>
                `;
            }).join('');

            document.getElementById('app-content').innerHTML = `
                <div class="app-header">
                    <h5 class="fw-bold m-0">Disimpan</h5>
                </div>
                <div class="container mt-3 pb-3">
                    ${listHtml}
                </div>
            `;
        }

        // --- LOGIC FUNCTIONS ---

        function filterList(type) {
            const input = document.getElementById('searchInput').value.toLowerCase();
            const data = type === 'honda' ? hondaData : yamahaData;
            
            const filtered = data.filter(item => 
                item.sensor.toLowerCase().includes(input) || 
                item.code.toString().includes(input) ||
                item.cause.toLowerCase().includes(input)
            );

            const listContainer = document.getElementById('listContainer');
            if (filtered.length === 0) {
                listContainer.innerHTML = '<div class="text-center mt-4 text-muted">Tidak ditemukan.</div>';
                return;
            }

            listContainer.innerHTML = filtered.map((item, index) => `
                <div class="custom-card p-3 d-flex align-items-center" onclick="openDetail('${type}', ${item.code})">
                    <div class="code-badge ${type === 'yamaha' ? 'yamaha' : ''} me-3 shadow-sm">
                        ${item.code}
                    </div>
                    <div class="flex-grow-1">
                        <h6 class="fw-bold m-0 text-dark">${item.sensor}</h6>
                        <small class="text-muted text-truncate d-block" style="max-width: 200px;">
                            ${item.cause}
                        </small>
                    </div>
                    <i class="material-icons text-muted">chevron_right</i>
                </div>
            `).join('');
        }

        let currentDetail = null;

        function openDetail(type, code) {
            const data = type === 'honda' ? hondaData : yamahaData;
            const item = data.find(d => d.code === code);
            currentDetail = { type, code };

            const isFav = favorites.some(f => f.code === code && f.type === type);
            
            // Populate Modal
            document.getElementById('modalTitle').innerText = `${type === 'honda' ? 'Honda' : 'Yamaha'} - Kode ${item.code}`;
            
            document.getElementById('modalBody').innerHTML = `
                <div class="text-center mb-4">
                    <div class="d-inline-block rounded-circle p-3 mb-2" style="background: #E3F2FD;">
                        <i class="material-icons text-primary" style="font-size: 32px;">settings_input_component</i>
                    </div>
                    <h4 class="fw-bold text-dark">${item.sensor}</h4>
                </div>

                <div class="section-title">PENYEBAB UTAMA</div>
                <div class="alert alert-danger border-0 d-flex align-items-start mt-2">
                    <i class="material-icons me-2 mt-1" style="font-size:18px;">warning</i>
                    <div>${item.cause}</div>
                </div>

                <div class="section-title">SOLUSI / PERBAIKAN</div>
                <div class="alert alert-success border-0 d-flex align-items-start mt-2">
                    <i class="material-icons me-2 mt-1" style="font-size:18px;">check_circle</i>
                    <div>${item.solution}</div>
                </div>

                <div class="section-title">LANGKAH PENGECEKAN</div>
                <ul class="list-group list-group-flush mt-2 small text-secondary">
                    <li class="list-group-item bg-transparent px-0"><i class="material-icons align-middle fs-6">arrow_right</i> Cek kondisi soket & kabel.</li>
                    <li class="list-group-item bg-transparent px-0"><i class="material-icons align-middle fs-6">arrow_right</i> Ukur tegangan/resistansi dengan Multitester.</li>
                    <li class="list-group-item bg-transparent px-0"><i class="material-icons align-middle fs-6">arrow_right</i> Reset ECU setelah perbaikan.</li>
                </ul>
            `;

            // Setup Fav Button
            const favBtn = document.getElementById('btnModalFav');
            if (isFav) {
                favBtn.classList.remove('btn-warning');
                favBtn.classList.add('btn-secondary');
                favBtn.innerHTML = '<i class="material-icons" style="font-size:18px; vertical-align:middle;">delete</i> Hapus';
            } else {
                favBtn.classList.remove('btn-secondary');
                favBtn.classList.add('btn-warning');
                favBtn.innerHTML = '<i class="material-icons" style="font-size:18px; vertical-align:middle;">star</i> Simpan';
            }
            
            // Attach Click Event directly to handle latest state
            favBtn.onclick = () => toggleFavoriteFromModal(type, code);

            const modal = new bootstrap.Modal(document.getElementById('detailModal'));
            modal.show();
        }

        function toggleFavoriteFromModal(type, code) {
            const index = favorites.findIndex(f => f.code === code && f.type === type);
            
            if (index === -1) {
                favorites.push({ type, code });
                showToast("Berhasil disimpan ke Favorit");
            } else {
                favorites.splice(index, 1);
                showToast("Dihapus dari Favorit");
            }
            saveToLocal();
            
            // Close modal & refresh logic if needed
            const modalEl = document.getElementById('detailModal');
            const modal = bootstrap.Modal.getInstance(modalEl);
            modal.hide();

            // If we are on favorites page, refresh it
            const activeNav = document.querySelector('.nav-item.active span').innerText;
            if(activeNav === 'Simpan') {
                renderFavorites();
            }
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            router('home');
        });

    </script>
</body>
</html>
